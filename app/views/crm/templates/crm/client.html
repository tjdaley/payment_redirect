{% extends 'layout.html' %}
{% block body %}
    <h1>{{operation}} Client {% if client._id != '0'%}: {{client.name.title}} {{client.name.first_name}} {{client.name.middle_name}} {{client.name.last_name}}
    {{client.name.suffix}}{% endif %}</h1>
    {% from 'includes/_formhelpers.html' import render_field, render_checkbox %}
    <form method='POST' action="{{url_for('crm_routes.save_client')}}">
        <input type='hidden' name='_id' id='_id' value='{{client._id}}'>
        <input type='hidden' name='orig_trust_balance' value='{{client.trust_balance}}'>
        {{ form.hidden_tag() }}
        <div class="form-row">
            <div class="form-group col">
                {{render_field(form.billing_id, class_="form-control", value=client.billing_id)}}
            </div>
        </div>

        <!--NAVIGATION TABS-->
        <nav role="navigation">
            <ul class="nav nav-pills" role="tablist">
                {% for tab in tabs %}
                    <li class="{{tab.li_class}}" role="presentation">
                        <button class="nav-link {{tab.selected}}"
                            id="{{tab.name}}-tab"
                            href="#{{tab.name}}"
                            aria-label="{{tab.name}}"
                            data-bs-toggle="tab"
                            data-bs-target="#{{tab.name}}"
                            role="tab"
                            aria-controls="{{tab.name}}"
                            type="button"
                        >{{tab.label}}</button>
                    </li>
                {% endfor %}
            </ul>
        </nav>

        <!--TAB CONTENT-->
        <div class="tab-content" id="client_tab_content">
            {% include '/crm/includes/_client_name.html' %}
            {% include '/crm/includes/_client_address.html' %}
            {% include '/crm/includes/_client_contact.html' %}
            {% include '/crm/includes/_client_case.html' %}
            {% include '/crm/includes/_client_contacts.html' %}
            {% include '/crm/includes/_client_children.html' %}
            {% include '/crm/includes/_client_dates.html' %}
            {% include '/crm/includes/_client_marketing.html' %}
            {% include '/crm/includes/_client_access.html' %}
            {% include '/crm/includes/_client_id.html' %}
            {% include '/crm/includes/_client_insurance.html' %}
            {% include '/crm/includes/_client_billing.html' %}
            {% if 'PIONEER_USER' in authorizations %}
            {% include '/crm/includes/_client_plan.html' %}
            {% endif %}
        </div>
        <button class="btn btn-primary my-3" type="submit">Save</button>
        <a href="/crm" class="btn btn-secondary my-3 mx-3">Cancel</a>
    </form>

    {% include '/crm/includes/_client_add_child_modal.html' %}
    {% include '/crm/includes/_client_add_case_event_modal.html' %}
    {% include '/crm/includes/_client_send_sms_modal.html' %}

    <script>
        window.addEventListener('load', client_init);
        /**
         * Form initialization.
         * Set up listeners and prepopulate select inputs.
         */
        function client_init() {
            var e = document.getElementById('case_county');
            if (!e) {
                alert('case_county control missing');
                return;
            }
            e.addEventListener("change", county_change);
 
            e = document.getElementById('court_type');
            if (!e) {
                alert('court_type control missing');
                return;
            }
            e.addEventListener("change", court_type_change);

            $('#addChildModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget); // Button that triggered modal
                console.log("MODAL TRIGGERED");
            });

            $('#addChildModal').on('shown.bs.modal', function (event) {
                var button = $(event.relatedTarget); // Button that triggered modal
                console.log("MODAL APPEARS");
            });

            $('.editable_contact_role').on('blur', function (event) {
                var new_role = event.target.textContent;
                var record_id = event.target.dataset.clientsContactsId;
                var post_data = {
                    role: new_role,
                    id: record_id
                };
                jQuery.post(
                    '/crm/util/update_contact_role',
                    post_data,
                    function (data) {
                        if (data.success)
                        {
                            // meh
                        }
                        else
                        {
                            console.log(data);
                        }
                    },
                    'json');
            });

            contacts_init();
        }

        function contacts_init() {
            $('[data-tooltip~="tooltip"]').tooltip();
            $('#message-text').focus(function (event) {
                $('#message-result').html('');
            });

            $('#smsMessageModal').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget); // Button that triggered modal
                var recipient = button.data('name');
                var telephone = button.data('telephone');
                var modal = $(this);
                modal.find('.modal-title').text('Send Message to ' + recipient);
                modal.find('.modal-body input').val(telephone);
                modal.find('.modal-body textarea').val('');
                $('#message-result').html('');
            }
            );
        }


        /**
         * Gets a list of court types for the given county when
         * the case_county value changes.
         */
        function county_change(ev) {
            $('#court_type').empty();
            $('#court_name').empty();
            var county = document.getElementById('case_county').value;
            var url = '/crm/data/court_types/' + county + '/';
            jQuery.get(
                url,
                function(data){update_select_options('#court_type', data);}
            );
        }

        /**
         * Gets a list of courts for the given county and court type when
         * the court_type value changes.
         */
        function court_type_change(ev) {
            $('#court_name').empty();
            var county = document.getElementById('case_county').value;
            var court_type = document.getElementById('court_type').value;
            var url = '/crm/data/court_names/' + county + '/' + court_type + '/';
            jQuery.get(
                url,
                function(data){update_select_options('#court_name', data);}
            );
        }

        /**
         * Create a new Event subform on the plan tab.
         * 
         * TJD: I created the template by showing the source of a subform, pasting it into a text editor,
         * and then changing the loop-index number to XX and inserting template variables. Finally, I removed
         * the outter <div> tag because it's added below.
         */
        function create_new_event_form(next_index) {
            var template = '<div class="row g-3 p-2"> <div class="form-group col-md-3"> <label for="case_events-XX-due_date">Due date</label> <input class="form-control" id="case_events-XX-due_date" name="case_events-XX-due_date" type="date" value="**DUE_DATE**"> </div> <div class="form-group col-md-7"> <label for="case_events-XX-description">Description</label> <input class="form-control" id="case_events-XX-description" name="case_events-XX-description" type="text" value="**DESCRIPTION**"> </div> <div class="form-group col-md-1"> <div> <label for="case_events-XX-completed">Done?</label> </div> <div> <input class="form-check-input mt-0" id="case_events-XX-completed" name="case_events-XX-completed" type="checkbox" aria_label="Completed" > </div> </div> <div class="form-group col-md-1"> <div>&nbsp;</div> <button class="btn float-end btn-outline-secondary fa fa-arrow-down" id="btn_show_notes" data-bs-toggle="collapse" data-bs-target="#notes_XX" type="button"> </button> </div> </div> <div class="collapse" id="notes_XX"> <div class="row g-3 p-2"> <div class="form-group col-md-3"> <label for="case_events-XX-assigned_to">Assigned to</label> <input class="form-control" id="case_events-XX-assigned_to" name="case_events-XX-assigned_to" type="text" value="**ASSIGNED_TO**"> </div> <div class="form-group col-md-4"> <label for="case_events-XX-event_type">Event type</label> <select class="form-control" id="case_events-XX-event_type" name="case_events-XX-event_type" value="T"><option **SELECTED_T** value="T">Task</option><option **SELECTED_D** value="D">Deadline</option><option **SELECTED_H** value="H">Hearing</option><option **SELECTED_M** value="M">Milestone</option></select> </div> <div class="form-group col-md-3"> <label for="case_events-XX-date_completed">Date completed</label> <input class="form-control" id="case_events-XX-date_completed" name="case_events-XX-date_completed" type="date" value="**DATE_COMPLETED**"> </div> <div class="form-group col-md-1"> <div> <label for="case_events-XX-hide">Hide?</label> </div> <div> <input class="form-check-input mt-0" id="case_events-XX-hide" name="case_events-XX-hide" type="checkbox" aria_label="Hide" > </div> </div> <div class="form-group col-md-12"> <label for="case_events-XX-notes">Notes</label> <textarea class="form-control" id="case_events-XX-notes" name="case_events-XX-notes" value="**NOTES**">**NOTES**</textarea> </div> </div> </div>';

            var form = document.getElementById('addEventModal');
            var due_date = form.querySelector('#due_date').value;
            var description = form.querySelector('#description').value;
            var assigned_to = form.querySelector('#assigned_to').value;
            var event_type = form.querySelector('#event_type').value;
            //var date_completed = form.querySelector('#date_completed').value;
            var notes = form.querySelector('#notes').value;
            //var hide = form.querySelector('#hide').checked;
            //var completed = form.querySelector('#completed').checked;
            console.log('due_date: ' + due_date);
            console.log('description: ' + description);
            console.log('assigned_to: ' + assigned_to);
            console.log('event_type: ' + event_type);
            console.log('notes: ' + notes);

            var new_form = template.replace(/XX/g, next_index);
            new_form = new_form.replace('**DUE_DATE**', due_date);
            new_form = new_form.replace('**DESCRIPTION**', description);
            new_form = new_form.replace('**ASSIGNED_TO**', assigned_to);
            //new_form = new_form.replace('**DATE_COMPLETED**', date_completed);
            new_form = new_form.replaceAll('**NOTES**', notes);
            new_form = new_form.replace('**SELECTED_T**', event_type == 'T' ? 'selected' : '');
            new_form = new_form.replace('**SELECTED_D**', event_type == 'D' ? 'selected' : '');
            new_form = new_form.replace('**SELECTED_H**', event_type == 'H' ? 'selected' : '');
            new_form = new_form.replace('**SELECTED_M**', event_type == 'M' ? 'selected' : '');
            var new_child = document.createElement('div');
            new_child.innerHTML = new_form;
            new_child.classList.add('border', 'border-warning', 'rounded', 'mb-3');
            return new_child;
        }

        /**
         * Save an event from the addEvent pop-up to the task list on the plan tab.
         */
        function save_event() {
            var event_count = document.getElementById('event_count').value;
            var new_event = create_new_event_form(event_count);
            var event_list = document.getElementById('task-list');
            event_list.appendChild(new_event);
            $('#addEventModal').modal('hide');
            document.getElementById('addEventForm').reset();
            e = document.getElementById("planTitle");
            e.classList.remove('text-bg-primary');
            e.classList.add('text-bg-warning');
            e = document.getElementById("planWarning");
            e.innerHTML = " - YOU MUST CLICK [SAVE] TO SAVE CHANGES";
            event_count = parseInt(event_count) + 1;
            document.getElementById('event_count').value = event_count;
        }

        /**
         * Create a new child subform on the children tab.
         * This function does NOT save the child to the database.
         * It merely adds it to the UI.
         *
         * TODO: Determine whether NOT saving to the DB is a UX problem.
         */
        function save_child() {
            var next_index = $('#child_count').val();
            new_child = create_new_child_form(next_index);
            child_list = document.getElementById("child-list");
            child_list.append(new_child);
            populate_new_child_form(next_index);
            $("#addChildModal").modal('hide');
            next_index = parseInt(next_index);
            $('#child_count').val(next_index+1);
            document.getElementById("addChildForm").reset();
            e = document.getElementById("childTitle");
            e.classList.remove('text-bg-primary');
            e.classList.add('text-bg-warning');
            e = document.getElementById('childWarning');
            e.innerHTML = "- YOU MUST CLICK [SAVE] TO SAVE THE CHILD" + (next_index > 1 ? "REN" : "");
        }

        /**
         * Create new child subform to hold values collected from the
         * addChildModal.
         */
        function create_new_child_form(next_index) {
            console.log("Creating new child form with index of " + next_index);
            /*
            * Rename the XX fields and IDs to the next_index value.
            * 
            * <div class="border border-primary rounded mb-3 hidden child_template">
                    <div class="form-row mx-4">
                        <div class="form-group col-md">
                            <label for="children-XX-name-first_name">First name</label>
                            <input class="form-control" id="children-XX-name-first_name" name="children-XX-name-first_name" type="text">
                        </div>
                    </div>
                </div>
            */
            var rows = [
                [
                    {label: "First name", iclass: ["form-control"], id: "children-XX-name-first_name", name: "children-XX-name-first_name", type:"text", dclass: ["form-group", "col-md"]},
                    {label: "Middle name", iclass: ["form-control"], id: "children-XX-name-middle_name", name: "children-XX-name-middle_name", type:"text", dclass: ["form-group", "col-md"]},
                    {label: "Last name", iclass: ["form-control"], id: "children-XX-name-last_name", name: "children-XX-name-last_name", type:"text", dclass: ["form-group", "col-md"]},
                    {label: "Suffix", iclass: ["form-control"], id: "children-XX-name-suffix", name: "children-XX-name-suffix", type:"text", dclass: ["form-group", "col-md-2"]},
                ],
                [
                    {label: "Sex", iclass: ["form-control"], id: "children-XX-sex", name: "children-XX-sex", type:"text", dclass: ["form-group", "col-md"]},
                    {label: "Birth date", iclass: ["form-control"], id: "children-XX-dob", name: "children-XX-dob", type:"text", dclass: ["form-group", "col-md"]},
                    {label: "Home state", iclass: ["form-control"], id: "children-XX-home_state", name: "children-XX-home_state", type:"text", dclass: ["form-group" ,"col-md"]},
                    {label: "SSN", iclass: ["form-control"], id: "children-XX-ssn", name: "children-XX-ssn", type:"text", dclass: ["form-group", "col-md-2"]},
                ]
            ]

            var newChild = document.createElement("div");
            newChild.classList.add("border", "border-warning", "rounded", "mb-3");

            rows.forEach((row) => {
                var newRow = document.createElement("div");
                newRow.classList.add("form-row", "mx-4");
                row.forEach((field) => {
                    var outterDiv = document.createElement("div");
                    outterDiv.classList.add(...field.dclass);
                    var newLabel = document.createElement("label");
                    newLabel.htmlFor = field.id.replace("XX", next_index);
                    newLabel.textContent = field.label;
                    var newInput = document.createElement("input");
                    newInput.setAttribute('type', field.type);
                    newInput.classList.add(...field.iclass);
                    newInput.setAttribute("id", field.id.replace("XX", next_index));
                    newInput.setAttribute("name", field.name.replace("XX", next_index));
                    outterDiv.append(newLabel);
                    outterDiv.append(newInput);
                    newRow.append(outterDiv);
                });
                newChild.append(newRow);
            });
            return newChild;
        }

        /**
         * Populate the given child subform with values from the addChildModal.
         */
        function populate_new_child_form(next_index) {
            console.log("Populating new child form with index of " + next_index);
            var fields = ['name-first_name', 'name-middle_name', 'name-last_name', 'name-suffix', 'sex', 'dob', 'home_state', 'ssn'];
            fields.forEach((element) => {
                var dest_selector = '#children-' + next_index + '-' + element;
                var src_selector = '#addChildForm #' + element;
                var value = $(src_selector).val();
                console.log({'From': src_selector, 'To': dest_selector, 'Value': value});
                $(dest_selector).val(value);
            });
        }

        /**
         * Update the options in a given select control.
         */
        function update_select_options(selector, result) {
            var select = $(selector);
            select.empty();
            select.append(make_options(result));
        }

        /*
         * Make an <option> string from an array.
         */
        function make_options(arr) {
            var options = '';
            arr.forEach(element => {
                options += '<option value="' + element + '">' + element + '</option>';
            });
            return options;
        }

        /**
         * Suggest a payment due based on all the inputs in the billing tab.
         */
        function suggestPaymentDue() {
            var payment_due = computePaymentDue().toFixed(2);
            var field = document.getElementById('payment_due');
            field.value = payment_due;
            field.textContent = payment_due;
        }

        function computePaymentDue(){
            var trust_balance = getDollarAmount('trust_balance');
            var unbilled_fees = getDollarAmount('unbilled_fees');
            var unbilled_costs = getDollarAmount('unbilled_costs');
            var target_retainer = getDollarAmount('target_retainer');
            var refresh_trigger = getDollarAmount('refresh_trigger');
            var mediation_retainer = getDollarAmount('mediation_retainer');
            var trial_retainer = getDollarAmount('trial_retainer');

            var mediation_retainer_flag = document.getElementById('mediation_retainer_flag').checked;
            var trial_retainer_flag = document.getElementById('trial_retainer_flag').checked;
            var final_bill_flag = document.getElementById('final_bill_flag').checked;

            var account_balance = trust_balance - unbilled_fees - unbilled_costs;

            // FINAL BILL
            if (final_bill_flag) {
                return account_balance < 0 ? Math.abs(account_balance) : 0.00;
            }

            if (mediation_retainer_flag) {
                target_retainer = mediation_retainer;
            }

            if (trial_retainer_flag) {
                target_retainer = trial_retainer;
            }

            if (target_retainer > account_balance) {
                return target_retainer - account_balance;
            }

            return 0.00;
        }

        function getDollarAmount(element_id) {
            var e = document.getElementById(element_id);
            if (!e) return 0.00;
            var v = e.value;
            try {
                v = parseFloat(v);
            }
            catch{
                v = 0.00;
            }
            if (isNaN(v)) v = 0.00
            return v;
        }

        function send_message() {
            var telephone = encodeURIComponent($('#recipient-telephone').val());
            var message = encodeURIComponent($('#message-text').val());
            $('#message-result').html('');
            jQuery.get(
                '/crm/util/send_message/' + telephone + '/' + message + '/',
                function (data) {
                    if (data.redirect) {
                        window.location.href = data.redirect;
                        return false;
                    }
                    $('#message-result').html(data.message);
                    $('#message-text').val('');
                });
        }

        function dial(to_number) {
            var opts = {
                to_number: to_number
            };
            dialer.dial(opts);
        }

        function load_msft_case_plan() {
            var url = "{{ url_for('crm_routes.get_msft_client_plan', client_id=client.billing_id)}}";
            jQuery.get(
                url,
                function(data) {
                    console.log(data);
                    show_case_plan(data);
                }
            );
        }

        function load_click_up_case_plan() {
            var url = "{{ url_for('crm_routes.get_click_up_client_plan', billing_id=client.billing_id)}}";
            jQuery.get(
                url,
                function(data) {
                    //console.log(data);
                    if (data.login_required) {
                        alert(data.auth_url);
                        window.location.href = data.auth_url;
                        return false;
                    }
                    show_click_up_case_plan(data.tasks);
                }
            );
        }

        function begin_plan(title) {
            var html = ''.concat(
                '<div class="form-row">\n\t<h3>', title, '</h3>\n</div>', task_titles());
            return html;
        }

        function task_titles() {
            var html = ''.concat(
                '\n\t<div class="form-row">',
                '\n\t\t<div class="form-group col-md-6">Task</div>',
                '\n\t\t<div class="form-group col-md-3">Owner</div>',
                '\n\t\t<div class="form-group col-md-1">Due</div>',
                '\n\t\t<div class="form-group col-md-1">Status</div>',
                '\n\t\t<div class="form-group col-md-1">Done</div>',
                '\n\t</div>\n');
            return html;
        }

        function plan_task(task) {
            var html = ''.concat(
                '\n\t<div class="form-row">',
                '\n\t\t<div class="form-group col-md-6">', task.title, '</div>',
                '\n\t\t<div class="form-group col-md-3">', task.assigned_to, '</div>',
                '\n\t\t<div class="form-group col-md-1">', task.due_date, '</div>',
                '\n\t\t<div class="form-group col-md-1">', task.percent_complete, '</div>',
                '\n\t\t<div class="form-group col-md-1">', task.complete_date, '</div>',
                '\n\t</div>\n');
            return html;

        }

        function end_plan() {
            return '';
        }

        function create_click_up_case_plan_html(plan) {
            var html = '';
            var title = "Click Up Tasks";
            html += begin_plan(title);

            plan.forEach((task) => {
                var _normalized_task = new Object();
                _normalized_task.title = task.name;
                _normalized_task.assigned_to = make_click_up_assignee(task.assignees[0], task.name);
                _normalized_task.due_date = timestamp2Datestr(task.due_date, 'red', 'white', 'black', 'yellow');
                _normalized_task.percent_complete = make_click_up_task_status(task.status);
                _normalized_task.complete_date = timestamp2Datestr(task.date_closed);
                html += plan_task(_normalized_task);
            });
            html += end_plan()
            return html;
        }

        function make_click_up_task_status(status) {
            var html = '<span style="background-color:{bgcolor}">{status_text}</span>';
            html = html.replace('{bgcolor}', status.color);
            html = html.replace('{status_text}', status.status);
            return html;
        }

        function make_click_up_assignee(assignee, task_name) {
            var html = '<a href="mailto:{email}?subject={{client.name.last_name}} - {subject}">{initials}</a>';
            html = html.replace('{email}', assignee.email);
            html = html.replace('{subject}', task_name);
            html = html.replace('{initials}', assignee.initials);
            return html;
        }

        function timestamp2DatestrYYYMMMDD(timestamp) {
            if (timestamp === null) return '';
            var date = new Date(parseInt(timestamp));
            var day = "0" + String(date.getDate());
            var month = "0" + String(date.getMonth() + 1);
            var year = String(date.getFullYear());
            return year + '-' + month.substr(-2) + '-' + day.substr(-2);
        }

        function timestamp2Datestr(timestamp, past_bg_color, past_fg_color, near_bg_color, near_fg_color) {
            if (timestamp === null) return '';
            var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            var date = new Date(parseInt(timestamp));
            var day = "0" + String(date.getDate());
            var month = months[date.getMonth()];
            var result = month + ' ' + day.substr(-2);

            // Highlight past-due dates, if asked to.
            if (timestamp < Date.now() && past_bg_color != null) {
                result = '<span style="background-color:{bg};color:{fg}">' + result + '</span>';
                result = result.replace('{bg}', past_bg_color).replace('{fg}', past_fg_color);
            }
            // Highlight close-by dates, if asked to.
            else if (daysFromNow(date) < 15 && near_bg_color) {
                result = '<span style="background-color:{bg};color:{fg}">' + result + '</span>';
                result = result.replace('{bg}', near_bg_color).replace('{fg}', near_fg_color);
            }
            return result;
        }

        function daysFromNow(date) {
            var diff_in_millis = date.getTime() - Date.now();
            var diff_in_days = diff_in_millis / (1000 * 3600 * 24);
            return diff_in_days;
        }

        function create_case_plan_html(plan) {
            var html = '';
            plan.forEach((bucket) => {
                var title = bucket.title;
                console.log(title);
                html += begin_plan(title);
                bucket.tasks.forEach((task) => {
                    html += plan_task(task);
                });
                html += end_plan();
            });
            return html;
        }

        function show_click_up_case_plan(plan) {
            var html = create_click_up_case_plan_html(plan);
            e = document.getElementById('case_plan');
            if (!e) {
                alert('case_plan element missing');
            }
            else {
                e.innerHTML = html;
            }
        }

        function show_case_plan(plan) {
            var html = create_case_plan_html(plan);
            e = document.getElementById('case_plan');
            if (!e) {
                alert('case_plan element missing');
            }
            else {
                e.innerHTML = html;
            }
        }

        function create_disclosures_plan() {
            var url = "{{ url_for('crm_routes.create_plan', client_id=client.billing_id, plan_type=2)}}";
            jQuery.get(
                url,
                function (data) {
                    console.log(data);
                    load_case_plan();
                }
            );
        }

        function formatAddress(delimiter) {
            var title = document.getElementById('name-title').value;
            if (title) title += " ";
            var fname = document.getElementById('name-first_name').value;
            if (fname) fname += " ";
            var mname = document.getElementById('name-middle_name').value;
            if (mname) mname += " ";
            var lname = document.getElementById('name-last_name').value;
            var suffix = document.getElementById('name-suffix').value;
            if (lname && suffix) {
                lname += " ";
            }
            var street = document.getElementById('address-street').value;
            var city = document.getElementById('address-city').value;
            var state = document.getElementById('address-state').value;
            var zip = document.getElementById('address-postal_code').value;
            var address = title + fname + mname + lname + suffix + delimiter + street + delimiter + city + ", " + state + " " + zip;
            return address;
        }

        function copyMultineAddressToClipboard() {
            copyToClipboard(formatAddress("\n"));
        }

        function copyOneLineAddressToClipboard() {
            copyToClipboard(formatAddress(", "));
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                /* set */
            }, function() {
                /* failed */
            });
        }

        function dim_row(element_id) {
            e = document.getElementById(element_id);
            if (e) {
                e.classList.add("table-dark");
            }
        }

        function unlink(client_id, contact_id, row_element_id, contact_name) {
            if (!window.confirm("Press OK to unlink " + contact_name + " from this client."))
                return false;
            var url = "/crm/util/unassign_contact/" + contact_id + "/" + client_id + "/";
            jQuery.get(
                url,
                function (data) {
                    console.log(data);
                    dim_row(row_element_id);
                }
            )
        }
        
    </script>
{% endblock %}
